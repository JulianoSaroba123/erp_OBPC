{% extends 'base.html' %}

{% block titulo %}
  {% if obreiro %}Editar Obreiro{% else %}Novo Obreiro{% endif %}
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Cabeçalho da página -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="text-dark mb-1">
                        <i class="fas fa-user-plus text-primary me-2"></i>
                        {% if obreiro %}Editar Obreiro{% else %}Novo Obreiro{% endif %}
                    </h2>
                    <p class="text-muted">
                        {% if obreiro %}
                            Edite as informações do obreiro {{ obreiro.nome }}
                        {% else %}
                            Preencha os dados para cadastrar um novo obreiro
                        {% endif %}
                    </p>
                </div>
                <div>
                    <a href="{{ url_for('obreiros.lista_obreiros') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>
                        Voltar à Lista
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulário -->
    <div class="row justify-content-center">
        <div class="col-xl-10">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-edit text-secondary me-2"></i>
                        Informações do Obreiro
                    </h5>
                </div>
                
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('obreiros.salvar_obreiro') }}" novalidate>
                        {% if obreiro %}
                            <input type="hidden" name="id" value="{{ obreiro.id }}">
                        {% endif %}
                        
                        <!-- Dados Pessoais -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2 mb-3">
                                    <i class="fas fa-user me-2"></i>
                                    Dados Pessoais
                                </h6>
                            </div>
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-8">
                                <label for="nome" class="form-label fw-bold">
                                    Nome Completo <span class="text-danger">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control form-control-lg" 
                                       id="nome" 
                                       name="nome" 
                                       value="{{ obreiro.nome if obreiro else '' }}" 
                                       required>
                                <div class="form-text">Nome completo do obreiro</div>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="status" class="form-label fw-bold">Status</label>
                                <select class="form-select form-select-lg" id="status" name="status">
                                    <option value="Ativo" {% if obreiro and obreiro.status == 'Ativo' %}selected{% elif not obreiro %}selected{% endif %}>Ativo</option>
                                    <option value="Inativo" {% if obreiro and obreiro.status == 'Inativo' %}selected{% endif %}>Inativo</option>
                                    <option value="Licenciado" {% if obreiro and obreiro.status == 'Licenciado' %}selected{% endif %}>Licenciado</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="telefone" class="form-label fw-bold">Telefone</label>
                                <input type="tel" 
                                       class="form-control" 
                                       id="telefone" 
                                       name="telefone" 
                                       value="{{ obreiro.telefone if obreiro else '' }}"
                                       placeholder="(11) 99999-9999">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="email" class="form-label fw-bold">E-mail</label>
                                <input type="email" 
                                       class="form-control" 
                                       id="email" 
                                       name="email" 
                                       value="{{ obreiro.email if obreiro else '' }}"
                                       placeholder="exemplo@email.com">
                            </div>
                        </div>

                        <!-- Ministério -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2 mb-3">
                                    <i class="fas fa-certificate me-2"></i>
                                    Informações do Ministério
                                </h6>
                            </div>
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="funcao" class="form-label fw-bold">Função/Cargo</label>
                                <select class="form-select" id="funcao" name="funcao">
                                    <option value="">Selecione a função...</option>
                                    <option value="Pastor" {% if obreiro and obreiro.funcao == 'Pastor' %}selected{% endif %}>Pastor</option>
                                    <option value="Pastor Auxiliar" {% if obreiro and obreiro.funcao == 'Pastor Auxiliar' %}selected{% endif %}>Pastor Auxiliar</option>
                                    <option value="Presbítero" {% if obreiro and obreiro.funcao == 'Presbítero' %}selected{% endif %}>Presbítero</option>
                                    <option value="Evangelista" {% if obreiro and obreiro.funcao == 'Evangelista' %}selected{% endif %}>Evangelista</option>
                                    <option value="Diácono" {% if obreiro and obreiro.funcao == 'Diácono' %}selected{% endif %}>Diácono</option>
                                    <option value="Diaconisa" {% if obreiro and obreiro.funcao == 'Diaconisa' %}selected{% endif %}>Diaconisa</option>
                                    <option value="Líder de Louvor" {% if obreiro and obreiro.funcao == 'Líder de Louvor' %}selected{% endif %}>Líder de Louvor</option>
                                    <option value="Músico" {% if obreiro and obreiro.funcao == 'Músico' %}selected{% endif %}>Músico</option>
                                    <option value="Professor EBD" {% if obreiro and obreiro.funcao == 'Professor EBD' %}selected{% endif %}>Professor EBD</option>
                                    <option value="Líder de Célula" {% if obreiro and obreiro.funcao == 'Líder de Célula' %}selected{% endif %}>Líder de Célula</option>
                                    <option value="Auxiliar" {% if obreiro and obreiro.funcao == 'Auxiliar' %}selected{% endif %}>Auxiliar</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="data_consagracao" class="form-label fw-bold">Data de Consagração</label>
                                <input type="date" 
                                       class="form-control" 
                                       id="data_consagracao" 
                                       name="data_consagracao" 
                                       value="{{ obreiro.data_consagracao.strftime('%Y-%m-%d') if obreiro and obreiro.data_consagracao else '' }}">
                                <div class="form-text">Data de consagração no ministério</div>
                            </div>
                        </div>

                        <!-- Observações -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2 mb-3">
                                    <i class="fas fa-sticky-note me-2"></i>
                                    Observações Adicionais
                                </h6>
                            </div>
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <label for="observacoes" class="form-label fw-bold">Observações</label>
                                <textarea class="form-control" 
                                          id="observacoes" 
                                          name="observacoes" 
                                          rows="4" 
                                          placeholder="Informações adicionais sobre o obreiro, especialidades, histórico...">{{ obreiro.observacoes if obreiro else '' }}</textarea>
                                <div class="form-text">Informações complementares, dons espirituais, histórico ministerial, etc.</div>
                            </div>
                        </div>

                        <!-- Botões de Ação -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a href="{{ url_for('obreiros.lista_obreiros') }}" class="btn btn-secondary btn-lg">
                                        <i class="fas fa-times me-2"></i>
                                        Cancelar
                                    </a>
                                    
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-save me-2"></i>
                                        {% if obreiro %}Atualizar Obreiro{% else %}Cadastrar Obreiro{% endif %}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border-radius: 15px;
    overflow: hidden;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 1px solid #e0e6ed;
    transition: all 0.2s ease;
}

.form-control:focus, .form-select:focus {
    border-color: var(--primary-green);
    box-shadow: 0 0 0 0.2rem rgba(34, 139, 34, 0.15);
}

.form-control-lg {
    padding: 1rem;
    font-size: 1.1rem;
}

.text-primary {
    color: var(--primary-green) !important;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
    border: none;
    border-radius: 8px;
    padding: 0.75rem 2rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(34, 139, 34, 0.3);
}

.btn-secondary {
    border-radius: 8px;
    padding: 0.75rem 2rem;
    font-weight: 600;
}

h6.text-primary {
    font-weight: 600;
    margin-bottom: 1rem;
}

.required-asterisk {
    color: #dc3545;
}
</style>

<script>
// Máscara para telefone
document.getElementById('telefone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(\d{2})(\d)/, '($1) $2');
    value = value.replace(/(\d{5})(\d)/, '$1-$2');
    e.target.value = value;
});

// Validação do formulário
document.querySelector('form').addEventListener('submit', function(e) {
    const nome = document.getElementById('nome').value.trim();
    
    if (!nome) {
        e.preventDefault();
        alert('Por favor, preencha o nome do obreiro.');
        document.getElementById('nome').focus();
    }
});

// Mudança de ícone baseado na função
document.getElementById('funcao').addEventListener('change', function(e) {
    const funcao = e.target.value;
    // Aqui poderia adicionar lógica para mudar ícones ou cores baseado na função
});
</script>
{% endblock %}