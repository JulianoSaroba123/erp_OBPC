{% extends "base.html" %}

{% block title %}Agenda Pastoral - OBPC{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Cabeçalho -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2><i class="fas fa-calendar-check text-primary me-2"></i>Agenda Pastoral</h2>
                    <p class="text-muted mb-0">Gerenciamento da agenda de ministérios por evento</p>
                </div>
                <div>
                    <a href="{{ url_for('escala_ministerial.gerar_pdf_escala') }}" class="btn btn-outline-success me-2" target="_blank">
                        <i class="fas fa-file-pdf me-1"></i> Gerar PDF
                    </a>
                    <a href="{{ url_for('escala_ministerial.nova_escala') }}" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i> Nova Agenda
                    </a>
                </div>
            </div>

            <!-- Filtros -->
            <div class="card mb-4">
                <div class="card-body">
                    <form method="GET" class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Mês</label>
                            <select name="mes" class="form-select">
                                <option value="">Todos os meses</option>
                                {% for m in range(1, 13) %}
                                <option value="{{ m }}" {% if m == mes_atual %}selected{% endif %}>
                                    {{ meses[m-1] }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Ano</label>
                            <select name="ano" class="form-select">
                                {% for a in range(2024, 2030) %}
                                <option value="{{ a }}" {% if a == ano_atual %}selected{% endif %}>
                                    {{ a }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Pregador</label>
                            <input type="text" name="pregador" class="form-control" 
                                   value="{{ pregador_atual }}" placeholder="Nome do pregador">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-outline-primary d-block">
                                <i class="fas fa-search me-1"></i> Filtrar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Lista de Escalas -->
            {% if escalas %}
            <div class="card">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-primary">
                                <tr>
                                    <th>Data</th>
                                    <th>Evento</th>
                                    <th>Pregador</th>
                                    <th>Dirigente</th>
                                    <th>Louvor</th>
                                    <th>Intercessor</th>
                                    <th>Diaconia</th>
                                    <th width="120" class="text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for escala in escalas %}
                                <tr>
                                    <td>
                                        <strong>{{ escala.data_formatada }}</strong>
                                        {% if escala.data_evento %}
                                            <br><small class="text-muted">{{ escala.data_evento.strftime('%A')|replace('Monday','Segunda')|replace('Tuesday','Terça')|replace('Wednesday','Quarta')|replace('Thursday','Quinta')|replace('Friday','Sexta')|replace('Saturday','Sábado')|replace('Sunday','Domingo') }}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if escala.evento %}
                                            <strong>{{ escala.evento.titulo }}</strong>
                                            {% if escala.evento.local %}
                                                <br><small class="text-muted"><i class="fas fa-map-marker-alt me-1"></i>{{ escala.evento.local }}</small>
                                            {% endif %}
                                        {% else %}
                                            <span class="text-muted">{{ escala.titulo_evento or '-' }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ escala.pregador or '-' }}</td>
                                    <td>{{ escala.dirigente or '-' }}</td>
                                    <td>{{ escala.louvor or '-' }}</td>
                                    <td>{{ escala.intercessor or '-' }}</td>
                                    <td>{{ escala.diaconia or '-' }}</td>
                                    <td class="text-center">
                                        <div class="btn-group btn-group-sm">
                                            <a href="{{ url_for('escala_ministerial.editar_escala', escala_id=escala.id) }}" 
                                               class="btn btn-outline-primary" title="Editar">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <form method="POST" action="{{ url_for('escala_ministerial.excluir_escala', escala_id=escala.id) }}" class="d-inline">
                                                <button type="submit" class="btn btn-outline-danger" title="Excluir"
                                                        onclick="return confirm('Confirma exclusão da escala de {{ escala.data_formatada }}?')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- Estado vazio -->
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="fas fa-calendar-times text-muted mb-3" style="font-size: 3rem;"></i>
                    <h5 class="text-muted">Nenhuma agenda encontrada</h5>
                    <p class="text-muted mb-4">Comece criando uma nova agenda pastoral para os eventos.</p>
                    <a href="{{ url_for('escala_ministerial.nova_escala') }}" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i> Criar Primeira Agenda
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.btn-group-sm .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

.table th {
    border-top: none;
    font-weight: 600;
    color: #1e3a8a;
}

.table-hover tbody tr:hover {
    background-color: rgba(30, 58, 138, 0.05);
}

@media (max-width: 768px) {
    .table-responsive {
        font-size: 0.875rem;
    }
    
    .btn-group-sm .btn {
        padding: 0.2rem 0.4rem;
        font-size: 0.8rem;
    }
}
</style>
{% endblock %}